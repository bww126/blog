## 七、Http2
### 二进制分帧传输
	HTTP 2.0 将所有传输的信息分割为更小的消息和帧，并对它们采用二进制格式的编码

### 流、消息、帧
1. 流：已建立的连接上的双向字节流。
2. 消息：与逻辑消息对应的完整的一系列数据帧。
3. 帧：HTTP 2.0 通信的最小单位，每个帧包含帧首部，至少也会标识出当前帧所属的流。

* 所有通信都在一个 TCP 连接上完成。
* 流是连接中的一个虚拟信道，可以承载双向的消息;每个流都有一个唯一的整数
* 标识符(1、2...N)。
* 消息是指逻辑上的 HTTP 消息，比如请求、响应等，由一或多个帧组成。
* 帧是最小的通信单位，承载着特定类型的数据，如 HTTP 首部、负荷，等等。
* 简言之，HTTP 2.0 把 HTTP 协议通信的基本单位缩小为一个一个的帧，这些帧对应 着逻辑流中的消息。相应地，很多流可以并行地在同一个 TCP 连接上交换消息。

### 多向请求和响应
* 可以并行交错地发送请求，请求之间互不影响;
* 可以并行交错地发送响应，响应之间互不干扰;
* 只使用一个连接即可并行发送多个请求和响应;
* 消除不必要的延迟，从而减少页面加载的时间;
* 不必再为绕过 HTTP 1.x 限制而多做很多工作;
* 更多优势。

> 总之，HTTP 2.0 的二进制分帧机制解决了 HTTP 1.x 中存在的队首阻塞问题，也消 除了并行处理和发送请求及响应时对多个连接的依赖。结果，就是应用速度更快、 开发更简单、部署成本更低。

### 请求优先级
	把 HTTP 消息分解为很多独立的帧之后，就可以通过优化这些帧的交错和传输顺序，进一步提升性能。为了做到这一点，每个流都可以带有一个 31 比特的优先值:
	* 0 表示最高优先级;
	* 231-1 表示最低优先级。
有了这个优先值，客户端和服务器就可以在处理不同的流时采取不同的策略，以最 优的方式发送流、消息和帧。具体来讲，服务器可以根据流的优先级，控制资源分 配(CPU、内存、带宽)，而在响应数据准备好之后，优先将最高优先级的帧发送给 客户端。

### 每个请求来源同一个TCP连接
	HTTP 2.0 连接都是持久化的，而且客户端与服务器之间也只需要一个连接即可
* 所有数据流的优先次序始终如一;
* 压缩上下文单一使得压缩效果更好;
* 由于 TCP 连接减少而使网络拥塞状况得以改观; • 慢启动时间减少，拥塞和丢包恢复速度更快。

### 流量控制
	HTTP 2.0 为数据流和连接的流量控制提供了一个简单的机制:
* 流量控制基于每一跳进行，而非端到端的控制;
* 流量控制基于窗口更新帧进行，即接收方广播自己准备接收某个数据流的多少字节，以及对整个连接要接收多少字节;
* 流量控制窗口大小通过 WINDOW_UPDATE 帧更新，这个字段指定了流 ID 和窗口大小递增值;
* 流量控制有方向性，即接收方可能根据自己的情况为每个流乃至整个连接设置任意窗口大小;
* 流量控制可以由接收方禁用，包括针对个别的流和针对整个连接。

### 服务器推送
* 客户端可以缓存推送过来的资源; 
* 客户端可以拒绝推送过来的资源;
* 推送资源可以由不同的页面共享; 
* 服务器可以按照优先级推送资源。

### 首部压缩
* HTTP 2.0 在客户端和服务器端使用“首部表”来跟踪和存储之前发送的键-值对， 对于相同的数据，不再通过每次请求和响应发送;
* 首部表在 HTTP 2.0 的连接存续期内始终存在，由客户端和服务器共同渐进地更新 ;
* 每个新的首部键-值对要么被追加到当前表的末尾，要么替换表中之前的值。