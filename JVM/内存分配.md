# Java 运行时的内存划分

<img src="https://github.com/qqiabc521/blog/blob/master/resource/2.jpeg" width="600" height="450" alt="运行时内存结构图"/>

## 程序计数器

记录当前线程所执行的字节码行号，用于获取下一条执行的字节码。

当多线程运行时，每个线程切换后需要知道上一次所运行的状态、位置。由此也可以看出程序计数器是每个线程**私有**的。


## 虚拟机栈
虚拟机栈是有一个一个的栈帧组成，栈帧是在每一个方法调用时产生的。

每一个栈帧由`局部变量区`、`操作数栈`等组成。每创建一个栈帧压栈，当一个方法执行完毕之后则出栈。

* 如果线程请求的栈深度大于虚拟机所允许的深度，将抛出StackOverflowError异常。
* 如果JVM栈可以动态扩展，在初始化新线程时没有足够内存创建栈则抛出OutOfMemoryError异常。

**这块内存区域也是线程私有的。**

## Java 堆
`Java` 堆是整个虚拟机所管理的最大内存区域，所有的对象创建都是在这个区域进行内存分配，被所有线程共享。

这块区域也是垃圾回收器重点管理的区域，由于大多数垃圾回收器都采用`分代回收算法`，所有堆内存也分为 `新生代`、`老年代`，可以方便垃圾的准确回收。

堆的内存不需要相邻。使用者可以设置堆内存的大小，如果堆能够动态的扩展。控制最大最小堆内存。

如果内存溢出(若计算所需堆内存不足)，则抛出OutOfMemoryError

**这块内存属于线程共享区域。**

## 方法区

方法区主要用于存放已经被虚拟机加载的类信息，如`常量，静态变量，字段和方法数据；`。

VM不会选择对方法区进行垃圾回收或者压缩，方法区可固定大小，或按需伸缩。方法区的内存不需要相邻。

## 运行时常量池

运行时常量池是方法区的一部分，其中存放了一些符号引用。当 new 一个对象时，会检查这个区域是否有这个符号的引用。

## 本地方法栈

JVM一般用传统栈实现，俗称“C栈”用来支持本地方法（这些方法不是用java编程语言写的方法。
